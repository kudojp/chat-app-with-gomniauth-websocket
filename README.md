# chat-app-with-gomniauth-websocket

このプロジェクトは[GO 言語で認証機能つきのチャットアプリを作ってみた。](http://wild-data-chase.com/index.php/2019/03/28/post-686/#outline__4_7)を参考にしている。最初はこのサイトの写経からはじめ、のちに不具合修正、機能追加と行った形で発展させていく。

## 実行方法

\$ go run \*.go

## どのような設計か

ユーザが入室した時、ブラウザからの ws 通信は chatroom ハンドラで対処され、受信したユーザは join チャネルに入れる。これを go routine で走っている chatroom.run において対処する。

## 写経終了後に発展させられそうな点(バックログ)

- 日本語のメッセージを送れない
- Enter でメッセージを送れるようにする
- 認証未完了の状態でも"/chat"ページへアクセスできてしまい、それがユーザとしてカウントされ、またメッセージを送れてしまう
- チャットルーム内の各ユーザのプロフィール(と合計ユーザ数)を表示したい
- サーバにデプロイする
- ある一つメッセージを送ったらそのユーザはルームを自動的に退出することになる(リロードで再入室する)
- データの永続化
- chatroom を複数用意する

## 発展のログ

> ある一つメッセージを送ったらそのユーザはルームを自動的に退出することになる(リロードで再入室する)

200205: 今回のチャットルームへのアクセスはchatroom構造体のServeHTTPメソッドによってハンドリングされる。この中で以下の三点でwebsocketの通信が切断されていたので、これらを取り除いた。
* chatroom.ServeHTTP()における`defer func() {c.leave <- client}()`
* client.read()の最後の`c.socket.Close()`
* client.write()の最後の`c.socket.Close()`
